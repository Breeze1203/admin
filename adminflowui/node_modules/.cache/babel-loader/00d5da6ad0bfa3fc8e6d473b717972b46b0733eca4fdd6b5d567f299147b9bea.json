{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createTextVNode as _createTextVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-41b719cc\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  style: {\n    \"margin-top\": \"30px\",\n    \"width\": \"100%\"\n  }\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"label\", null, \"用户菜单权限\", -1 /* HOISTED */));\nconst _hoisted_3 = {\n  style: {\n    \"display\": \"flex\",\n    \"justify-content\": \"flex-end\"\n  }\n};\nconst _hoisted_4 = {\n  style: {\n    \"margin-top\": \"10px\"\n  }\n};\nconst _hoisted_5 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"label\", null, \"用户操作权限\", -1 /* HOISTED */));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_col = _resolveComponent(\"el-col\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_row = _resolveComponent(\"el-row\");\n  const _component_el_tree = _resolveComponent(\"el-tree\");\n  const _component_el_collapse_item = _resolveComponent(\"el-collapse-item\");\n  const _component_el_collapse = _resolveComponent(\"el-collapse\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_el_row, {\n    gutter: 6,\n    style: {\n      \"margin-bottom\": \"30px\"\n    }\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_col, {\n      xs: 4,\n      sm: 6,\n      md: 4,\n      lg: 3,\n      xl: 1\n    }, {\n      default: _withCtx(() => [_hoisted_2]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_col, {\n      xs: 4,\n      sm: 6,\n      md: 4,\n      lg: 3,\n      xl: 1\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_button, {\n        plain: \"\",\n        icon: \"Refresh\",\n        onClick: $options.initPermissions\n      }, {\n        default: _withCtx(() => [_createTextVNode(\"刷新\")]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"onClick\"])]),\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  }), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.roles, (role, index) => {\n    return _openBlock(), _createBlock(_component_el_collapse, {\n      accordion: \"\",\n      modelValue: $data.accordion,\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.accordion = $event),\n      onChange: $options.changeItem\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_collapse_item, {\n        style: {\n          \"font-size\": \"larger\"\n        },\n        title: role.nameZh,\n        name: role.id\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"div\", null, [_createVNode(_component_el_tree, {\n          \"show-checkbox\": \"\",\n          \"node-key\": \"menu_id\",\n          \"default-checked-keys\": $data.checkedNodes,\n          data: this.menuData,\n          props: this.defaultProps\n        }, null, 8 /* PROPS */, [\"default-checked-keys\", \"data\", \"props\"])]), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_button, {\n          size: \"small\",\n          plain: \"\",\n          type: \"info\",\n          onClick: $options.cancel\n        }, {\n          default: _withCtx(() => [_createTextVNode(\"取消修改\")]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"onClick\"]), _createVNode(_component_el_button, {\n          size: \"small\",\n          plain: \"\",\n          type: \"danger\",\n          onClick: $event => $options.sure(role)\n        }, {\n          default: _withCtx(() => [_createTextVNode(\"确认修改\")]),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])])]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"title\", \"name\"])]),\n      _: 2 /* DYNAMIC */\n    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"modelValue\", \"onChange\"]);\n  }), 256 /* UNKEYED_FRAGMENT */))]), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_row, {\n    gutter: 6,\n    style: {\n      \"margin-bottom\": \"30px\"\n    }\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_col, {\n      xs: 4,\n      sm: 6,\n      md: 4,\n      lg: 3,\n      xl: 1\n    }, {\n      default: _withCtx(() => [_hoisted_5]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_col, {\n      xs: 4,\n      sm: 6,\n      md: 4,\n      lg: 3,\n      xl: 1\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_button, {\n        plain: \"\",\n        icon: \"Refresh\",\n        onClick: $options.initPermissions\n      }, {\n        default: _withCtx(() => [_createTextVNode(\"刷新\")]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"onClick\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_col, {\n      xs: 2,\n      sm: 3,\n      md: 5,\n      lg: 5,\n      xl: 7\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_button, {\n        plain: \"\",\n        type: \"success\",\n        icon: \"Upload\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(\"导出\")]),\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  }), _createVNode(_component_el_table, {\n    data: $data.operation,\n    style: {\n      \"width\": \"100%\"\n    },\n    \"row-key\": \"menu_id\",\n    border: \"\",\n    \"default-expand-all\": false\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_table_column, {\n      align: \"center\",\n      prop: \"id\",\n      label: \"唯一标识\"\n    }), _createVNode(_component_el_table_column, {\n      align: \"center\",\n      prop: \"name\",\n      label: \"权限标识\"\n    }), _createVNode(_component_el_table_column, {\n      align: \"center\",\n      prop: \"describe\",\n      label: \"操作权限描述\"\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"data\"]), _createVNode(_component_el_pagination, {\n    style: {\n      \"margin-top\": \"10px\"\n    },\n    \"page-sizes\": [3, 6, 9],\n    layout: \"total, sizes, prev, pager, next, jumper\",\n    total: $data.total,\n    background: \"\",\n    \"default-page-size\": 3,\n    onSizeChange: $options.handleSizeChange,\n    onCurrentChange: $options.handleCurrentChange\n  }, null, 8 /* PROPS */, [\"total\", \"onSizeChange\", \"onCurrentChange\"])])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["style","_createElementVNode","_hoisted_1","_createVNode","_component_el_row","gutter","_component_el_col","xs","sm","md","lg","xl","_hoisted_2","_component_el_button","plain","icon","onClick","$options","initPermissions","_createElementBlock","_Fragment","_renderList","$data","roles","role","index","_createBlock","_component_el_collapse","accordion","$event","onChange","changeItem","_component_el_collapse_item","title","nameZh","name","id","_component_el_tree","checkedNodes","data","menuData","props","defaultProps","_hoisted_3","size","type","cancel","sure","_hoisted_4","_hoisted_5","_component_el_table","operation","border","_component_el_table_column","align","prop","label","_component_el_pagination","layout","total","background","onSizeChange","handleSizeChange","onCurrentChange","handleCurrentChange"],"sources":["/Users/pt/Documents/code/adminflowui/src/components/set/Permission.vue"],"sourcesContent":["<template>\n  <div style=\"margin-top: 30px;width: 100%\">\n    <el-row :gutter=\"6\" style=\"margin-bottom: 30px\">\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <label>用户菜单权限</label>\n      </el-col>\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <el-button plain icon=\"Refresh\" @click=\"initPermissions\">刷新</el-button>\n      </el-col>\n    </el-row>\n    <el-collapse v-for=\"(role,index) in roles\" accordion v-model=\"accordion\" @change=\"changeItem\">\n      <el-collapse-item style=\"font-size: larger;\" :title=\"role.nameZh\" :name=\"role.id\">\n        <div>\n          <el-tree show-checkbox node-key=\"menu_id\"\n                   :default-checked-keys=\"checkedNodes\" :data=\"this.menuData\"\n                   :props=\"this.defaultProps\"\n          />\n        </div>\n        <div style=\"display: flex;justify-content: flex-end;\">\n          <el-button size=\"small\" plain type=\"info\" @click=\"cancel\">取消修改</el-button>\n          <el-button size=\"small\" plain type=\"danger\" @click=\"sure(role)\">确认修改</el-button>\n        </div>\n      </el-collapse-item>\n    </el-collapse>\n  </div>\n  <div style=\"margin-top: 10px\">\n    <el-row :gutter=\"6\" style=\"margin-bottom: 30px\">\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <label>用户操作权限</label>\n      </el-col>\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <el-button plain icon=\"Refresh\" @click=\"initPermissions\">刷新</el-button>\n      </el-col>\n      <el-col :xs=\"2\" :sm=\"3\" :md=\"5\" :lg=\"5\" :xl=\"7\">\n        <el-button plain type=\"success\" icon=\"Upload\">导出</el-button>\n      </el-col>\n    </el-row>\n    <el-table\n        :data=\"operation\"\n        style=\"width: 100%;\"\n        row-key=\"menu_id\"\n        border\n        :default-expand-all=\"false\">\n      <el-table-column align=\"center\" prop=\"id\" label=\"唯一标识\"></el-table-column>\n      <el-table-column align=\"center\" prop=\"name\" label=\"权限标识\"></el-table-column>\n      <el-table-column align=\"center\" prop=\"describe\" label=\"操作权限描述\"></el-table-column>\n    </el-table>\n    <el-pagination style=\"margin-top: 10px\"\n                   :page-sizes=\"[3, 6, 9]\"\n                   layout=\"total, sizes, prev, pager, next, jumper\"\n                   :total=total\n                   background\n                   :default-page-size=\"3\"\n                   @size-change=\"handleSizeChange\"\n                   @current-change=\"handleCurrentChange\"\n    />\n  </div>\n</template>\n<script>\nimport requestUtil from \"@/util/requestUtil\";\nimport permissions_request from \"@/api/permissions\";\nimport menu_request from \"@/api/menu\";\nimport {ElMessage, ElMessageBox} from \"element-plus\";\n\nexport default {\n  name: 'Permission',\n  data() {\n    return {\n      roles: [],\n      accordion: -1,\n      operation: [],\n      total: null,// 操作权限总条数,\n      page: 1,\n      size: 3,\n      menuData: [],\n      checkedNodes: [],\n      defaultProps: {\n        children: 'menus',\n        label: 'menu_name',\n      }\n    }\n  },\n  methods: {\n    // 初始化所有菜单\n    initMenu() {\n      menu_request.getAllMenus().then(resp => {\n        this.menuData = resp.data;\n      })\n    },\n    // 初始化所有角色\n    initRole() {\n      requestUtil.getAllRoles().then(resp => {\n        this.roles = resp.data;\n      })\n    },\n    // 初始化用户所有操作权限\n    initPermissions() {\n      permissions_request.getAllPermByPage(this.page, this.size).then(resp => {\n        this.operation = resp.data;\n      })\n    },\n    // 初始化操作权限条数\n    initCount() {\n      permissions_request.getPermissionCount().then(resp => {\n        this.total = resp.data;\n      })\n    },\n    // collapse切换\n    changeItem(rId) {\n      // 切换item时候，里面的数据需及时刷新\n      this.initMenu();\n      this.checkedNodes = [];\n      if (rId == null || rId == '') return;\n      menu_request.getMenusChecked(rId).then(resp => {\n        this.checkedNodes = resp.data;\n        console.log(this.checkedNodes);\n      });\n    },\n    // 取消修改菜单权限\n    cancel() {\n      this.checkedNodes = [];\n      this.accordion = -1;\n    },\n    // 确认修改\n    sure(role) {\n      if (this.checkedNodes.length == 0) {\n        ElMessage.error(\"请选择菜单权限\");\n        return;\n      }\n      ElMessageBox.confirm(\n          '此操作将会修改【' + role.nameZh + '】的菜单权限,是否继续',\n          {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning',\n          }\n      )\n          .then(() => {\n            // 将数组转为字符串\n            let nodes = this.checkedNodes.join(',');\n            menu_request.updateRoleMenuId(nodes,rid).then(resp => {\n              if(resp.data.code==200){\n                ElMessage.success(resp.data.message);\n              }else {\n                ElMessage.error(resp.data.message);\n              }\n            })\n          })\n          .catch(() => {\n            ElMessage({\n              type: 'info',\n              message: '操作取消',\n            })\n          })\n    },\n    handleSizeChange(size) {\n      this.size = size;\n      this.initPermissions();\n    },\n    handleCurrentChange(page) {\n      this.page = page;\n      this.initPermissions();\n    }\n  },\n  mounted() {\n    this.initRole();\n    this.initPermissions();\n    this.initCount();\n  }\n}\n</script>\n<style scoped>\n.collapse {\n  margin-top: 30px;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}