{"ast":null,"code":"import requestUtil from \"@/util/requestUtil\";\nimport permissions_request from \"@/api/permissions\";\nimport menu_request from \"@/api/menu\";\nimport { ElMessage, ElMessageBox } from \"element-plus\";\nimport store from \"@/store\";\nexport default {\n  name: 'Permission',\n  data() {\n    return {\n      roles: [],\n      accordion: -1,\n      operation: [],\n      total: null,\n      // 操作权限总条数,\n      page: 1,\n      size: 3,\n      menuData: [],\n      checkedNodes: [],\n      defaultProps: {\n        children: 'First_Children',\n        label: 'menu_name'\n      }\n    };\n  },\n  methods: {\n    // 初始化所有菜单\n    initMenu() {\n      menu_request.getAllMenus().then(resp => {\n        this.menuData = resp.data;\n        console.log(this.menuData);\n      });\n    },\n    // 初始化所有角色\n    initRole() {\n      requestUtil.getAllRoles().then(resp => {\n        this.roles = resp.data;\n      });\n    },\n    // 初始化用户所有操作权限\n    initPermissions() {\n      permissions_request.getAllPermByPage(this.page, this.size).then(resp => {\n        this.operation = resp.data;\n      });\n    },\n    // 初始化操作权限条数\n    initCount() {\n      permissions_request.getPermissionCount().then(resp => {\n        this.total = resp.data;\n      });\n    },\n    // collapse切换\n    changeItem(rId) {\n      // 切换item时候，里面的数据需及时刷新\n      this.initMenu();\n      this.checkedNodes = [];\n      if (rId == null || rId == '') return;\n      menu_request.getMenusChecked(rId).then(resp => {\n        this.checkedNodes = resp.data;\n      });\n    },\n    // 取消修改菜单权限\n    cancel() {\n      this.checkedNodes = [];\n      this.accordion = -1;\n    },\n    // 确认修改\n    sure(role, index) {\n      if (this.$refs.tree[index].getCheckedKeys().length === 0) {\n        ElMessage.error(\"请选择菜单权限\");\n        return;\n      }\n      ElMessageBox.confirm('此操作将会修改【' + role.nameZh + '】的菜单权限,是否继续', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        // 将数组转为字符串\n        let nodes = this.$refs.tree[index].getCheckedKeys(true).join(',');\n        menu_request.updateRoleMenuId(nodes, role.id).then(resp => {\n          if (resp.data.code == 200) {\n            ElMessage.success(resp.data.message);\n            // 如果当前修改用户的权限是目前登录用户的权限\n            if (role.id == JSON.parse(sessionStorage.getItem(\"user\")).id) {\n              // 刷新menu,同时更新vuex\n              menu_request.getMenusByRole(role.id).then(resp => {\n                store.commit(\"initMenu\", resp.data);\n              });\n            }\n            this.accordion = -1;\n          } else {\n            ElMessage.error(resp.data.message);\n          }\n        });\n      }).catch(() => {\n        ElMessage({\n          type: 'info',\n          message: '操作取消'\n        });\n      });\n    },\n    handleSizeChange(size) {\n      this.size = size;\n      this.initPermissions();\n    },\n    handleCurrentChange(page) {\n      this.page = page;\n      this.initPermissions();\n    }\n  },\n  mounted() {\n    this.initRole();\n    this.initPermissions();\n    this.initCount();\n  }\n};","map":{"version":3,"names":["requestUtil","permissions_request","menu_request","ElMessage","ElMessageBox","store","name","data","roles","accordion","operation","total","page","size","menuData","checkedNodes","defaultProps","children","label","methods","initMenu","getAllMenus","then","resp","console","log","initRole","getAllRoles","initPermissions","getAllPermByPage","initCount","getPermissionCount","changeItem","rId","getMenusChecked","cancel","sure","role","index","$refs","tree","getCheckedKeys","length","error","confirm","nameZh","confirmButtonText","cancelButtonText","type","nodes","join","updateRoleMenuId","id","code","success","message","JSON","parse","sessionStorage","getItem","getMenusByRole","commit","catch","handleSizeChange","handleCurrentChange","mounted"],"sources":["/Users/pt/Documents/code/adminflowui/src/components/set/Permission.vue"],"sourcesContent":["<template>\n  <div style=\"margin-top: 30px;width: 100%\">\n    <el-row :gutter=\"6\" style=\"margin-bottom: 30px\">\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <label>用户菜单权限</label>\n      </el-col>\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <el-button plain icon=\"Refresh\" @click=\"initPermissions\">刷新</el-button>\n      </el-col>\n    </el-row>\n    <el-collapse v-for=\"(role,index) in roles\" accordion v-model=\"accordion\" @change=\"changeItem\">\n      <el-collapse-item style=\"font-size: larger;\" :title=\"role.nameZh\" :name=\"role.id\">\n        <div>\n          <el-tree ref=\"tree\" show-checkbox node-key=\"menu_id\"\n                   :default-checked-keys=\"checkedNodes\" :data=\"this.menuData\"\n                   :props=\"this.defaultProps\"\n          />\n        </div>\n        <div style=\"display: flex;justify-content: flex-end;\">\n          <el-button size=\"small\" plain type=\"info\" @click=\"cancel\">取消修改</el-button>\n          <el-button size=\"small\" plain type=\"danger\" @click=\"sure(role,index)\">确认修改</el-button>\n        </div>\n      </el-collapse-item>\n    </el-collapse>\n  </div>\n  <div style=\"margin-top: 10px\">\n    <el-row :gutter=\"6\" style=\"margin-bottom: 30px\">\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <label>用户操作权限</label>\n      </el-col>\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <el-button plain icon=\"Refresh\" @click=\"initPermissions\">刷新</el-button>\n      </el-col>\n      <el-col :xs=\"2\" :sm=\"3\" :md=\"5\" :lg=\"5\" :xl=\"7\">\n        <el-button plain type=\"success\" icon=\"Upload\">导出</el-button>\n      </el-col>\n    </el-row>\n    <el-table\n        :data=\"operation\"\n        style=\"width: 100%;\"\n        row-key=\"menu_id\"\n        border\n        :default-expand-all=\"false\">\n      <el-table-column align=\"center\" prop=\"id\" label=\"唯一标识\"></el-table-column>\n      <el-table-column align=\"center\" prop=\"name\" label=\"权限标识\"></el-table-column>\n      <el-table-column align=\"center\" prop=\"describe\" label=\"操作权限描述\"></el-table-column>\n    </el-table>\n    <el-pagination style=\"margin-top: 10px\"\n                   :page-sizes=\"[3, 6, 9]\"\n                   layout=\"total, sizes, prev, pager, next, jumper\"\n                   :total=total\n                   background\n                   :default-page-size=\"3\"\n                   @size-change=\"handleSizeChange\"\n                   @current-change=\"handleCurrentChange\"\n    />\n  </div>\n</template>\n<script>\nimport requestUtil from \"@/util/requestUtil\";\nimport permissions_request from \"@/api/permissions\";\nimport menu_request from \"@/api/menu\";\nimport {ElMessage, ElMessageBox} from \"element-plus\";\nimport store from \"@/store\";\n\nexport default {\n  name: 'Permission',\n  data() {\n    return {\n      roles: [],\n      accordion: -1,\n      operation: [],\n      total: null,// 操作权限总条数,\n      page: 1,\n      size: 3,\n      menuData: [],\n      checkedNodes: [],\n      defaultProps: {\n        children: 'First_Children',\n        label: 'menu_name',\n      }\n    }\n  },\n  methods: {\n    // 初始化所有菜单\n    initMenu() {\n      menu_request.getAllMenus().then(resp => {\n        this.menuData = resp.data;\n        console.log(this.menuData)\n      })\n    },\n    // 初始化所有角色\n    initRole() {\n      requestUtil.getAllRoles().then(resp => {\n        this.roles = resp.data;\n      })\n    },\n    // 初始化用户所有操作权限\n    initPermissions() {\n      permissions_request.getAllPermByPage(this.page, this.size).then(resp => {\n        this.operation = resp.data;\n      })\n    },\n    // 初始化操作权限条数\n    initCount() {\n      permissions_request.getPermissionCount().then(resp => {\n        this.total = resp.data;\n      })\n    },\n    // collapse切换\n    changeItem(rId) {\n      // 切换item时候，里面的数据需及时刷新\n      this.initMenu();\n      this.checkedNodes = [];\n      if (rId == null || rId == '') return;\n      menu_request.getMenusChecked(rId).then(resp => {\n        this.checkedNodes = resp.data;\n      });\n    },\n    // 取消修改菜单权限\n    cancel() {\n      this.checkedNodes = [];\n      this.accordion = -1;\n    },\n    // 确认修改\n    sure(role,index) {\n      if (this.$refs.tree[index].getCheckedKeys().length === 0) {\n        ElMessage.error(\"请选择菜单权限\");\n        return;\n      }\n      ElMessageBox.confirm(\n          '此操作将会修改【' + role.nameZh + '】的菜单权限,是否继续',\n          {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning',\n          }\n      )\n          .then(() => {\n            // 将数组转为字符串\n            let nodes = this.$refs.tree[index].getCheckedKeys(true).join(',');\n            menu_request.updateRoleMenuId(nodes,role.id).then(resp => {\n              if(resp.data.code==200){\n                ElMessage.success(resp.data.message);\n                // 如果当前修改用户的权限是目前登录用户的权限\n                if(role.id==JSON.parse(sessionStorage.getItem(\"user\")).id){\n                  // 刷新menu,同时更新vuex\n                  menu_request.getMenusByRole(role.id).then(resp=>{\n                    store.commit(\"initMenu\",resp.data);\n                  })\n                }\n                this.accordion=-1;\n              }else {\n                ElMessage.error(resp.data.message);\n              }\n            })\n          })\n          .catch(() => {\n            ElMessage({\n              type: 'info',\n              message: '操作取消',\n            })\n          })\n    },\n    handleSizeChange(size) {\n      this.size = size;\n      this.initPermissions();\n    },\n    handleCurrentChange(page) {\n      this.page = page;\n      this.initPermissions();\n    }\n  },\n  mounted() {\n    this.initRole();\n    this.initPermissions();\n    this.initCount();\n  }\n}\n</script>\n<style scoped>\n.collapse {\n  margin-top: 30px;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}