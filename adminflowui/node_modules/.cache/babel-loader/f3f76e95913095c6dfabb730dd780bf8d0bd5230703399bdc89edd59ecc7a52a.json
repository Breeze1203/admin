{"ast":null,"code":"import requestUtil from \"@/util/requestUtil\";\nimport permissions_request from \"@/api/permissions\";\nimport menu_request from \"@/api/menu\";\nimport { update_Menu_Role } from \"@/util/confireMessage\";\nimport { ElMessage } from \"element-plus\";\nexport default {\n  name: 'Permission',\n  data() {\n    return {\n      roles: [],\n      accordion: -1,\n      operation: [],\n      total: null,\n      // 操作权限总条数,\n      page: 1,\n      size: 3,\n      menuData: [],\n      checkedNodes: [],\n      defaultProps: {\n        children: 'menus',\n        label: 'menu_name'\n      }\n    };\n  },\n  methods: {\n    // 初始化所有菜单\n    initMenu() {\n      menu_request.getAllMenus().then(resp => {\n        this.menuData = resp.data;\n      });\n    },\n    // 初始化所有角色\n    initRole() {\n      requestUtil.getAllRoles().then(resp => {\n        this.roles = resp.data;\n      });\n    },\n    // 初始化用户所有操作权限\n    initPermissions() {\n      permissions_request.getAllPermByPage(this.page, this.size).then(resp => {\n        this.operation = resp.data;\n      });\n    },\n    // 初始化操作权限条数\n    initCount() {\n      permissions_request.getPermissionCount().then(resp => {\n        this.total = resp.data;\n      });\n    },\n    // collapse切换\n    changeItem(rId) {\n      // 切换item时候，里面的数据需及时刷新\n      this.initMenu();\n      this.checkedNodes = [];\n      if (rId == null || rId == '') return;\n      menu_request.getMenusChecked(rId).then(resp => {\n        this.checkedNodes = resp.data;\n        console.log(this.checkedNodes);\n      });\n    },\n    // 取消修改菜单权限\n    cancel() {\n      this.checkedNodes = [];\n      this.accordion = -1;\n    },\n    // 确认修改\n    sure(role) {\n      if (this.checkedNodes.length == 0) {\n        ElMessage.error(\"请选择菜单权限\");\n        return;\n      }\n      update_Menu_Role(role, this.checkedNodes);\n    },\n    handleSizeChange(size) {\n      this.size = size;\n      this.initPermissions();\n    },\n    handleCurrentChange(page) {\n      this.page = page;\n      this.initPermissions();\n    }\n  },\n  mounted() {\n    this.initRole();\n    this.initPermissions();\n    this.initCount();\n  }\n};","map":{"version":3,"names":["requestUtil","permissions_request","menu_request","update_Menu_Role","ElMessage","name","data","roles","accordion","operation","total","page","size","menuData","checkedNodes","defaultProps","children","label","methods","initMenu","getAllMenus","then","resp","initRole","getAllRoles","initPermissions","getAllPermByPage","initCount","getPermissionCount","changeItem","rId","getMenusChecked","console","log","cancel","sure","role","length","error","handleSizeChange","handleCurrentChange","mounted"],"sources":["/Users/pt/Documents/code/adminflowui/src/components/set/Permission.vue"],"sourcesContent":["<template>\n  <div style=\"margin-top: 30px;width: 100%\">\n    <el-row :gutter=\"6\" style=\"margin-bottom: 30px\">\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <label>用户菜单权限</label>\n      </el-col>\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <el-button plain icon=\"Refresh\" @click=\"initPermissions\">刷新</el-button>\n      </el-col>\n    </el-row>\n    <el-collapse v-for=\"(role,index) in roles\" accordion v-model=\"accordion\" @change=\"changeItem\">\n      <el-collapse-item style=\"font-size: larger;\" :title=\"role.nameZh\" :name=\"role.id\">\n        <div>\n          <el-tree show-checkbox node-key=\"menu_id\"\n                   :default-checked-keys=\"checkedNodes\" :data=\"this.menuData\"\n                   :props=\"this.defaultProps\"\n          />\n        </div>\n        <div style=\"display: flex;justify-content: flex-end;\">\n          <el-button size=\"small\" plain type=\"info\" @click=\"cancel\">取消修改</el-button>\n          <el-button size=\"small\" plain type=\"danger\" @click=\"sure(role)\">确认修改</el-button>\n        </div>\n      </el-collapse-item>\n    </el-collapse>\n  </div>\n  <div style=\"margin-top: 10px\">\n    <el-row :gutter=\"6\" style=\"margin-bottom: 30px\">\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <label>用户操作权限</label>\n      </el-col>\n      <el-col :xs=\"4\" :sm=\"6\" :md=\"4\" :lg=\"3\" :xl=\"1\">\n        <el-button plain icon=\"Refresh\" @click=\"initPermissions\">刷新</el-button>\n      </el-col>\n      <el-col :xs=\"2\" :sm=\"3\" :md=\"5\" :lg=\"5\" :xl=\"7\">\n        <el-button plain type=\"success\" icon=\"Upload\">导出</el-button>\n      </el-col>\n    </el-row>\n    <el-table\n        :data=\"operation\"\n        style=\"width: 100%;\"\n        row-key=\"menu_id\"\n        border\n        :default-expand-all=\"false\">\n      <el-table-column align=\"center\" prop=\"id\" label=\"唯一标识\"></el-table-column>\n      <el-table-column align=\"center\" prop=\"name\" label=\"权限标识\"></el-table-column>\n      <el-table-column align=\"center\" prop=\"describe\" label=\"操作权限描述\"></el-table-column>\n    </el-table>\n    <el-pagination style=\"margin-top: 10px\"\n                   :page-sizes=\"[3, 6, 9]\"\n                   layout=\"total, sizes, prev, pager, next, jumper\"\n                   :total=total\n                   background\n                   :default-page-size=\"3\"\n                   @size-change=\"handleSizeChange\"\n                   @current-change=\"handleCurrentChange\"\n    />\n  </div>\n</template>\n<script>\nimport requestUtil from \"@/util/requestUtil\";\nimport permissions_request from \"@/api/permissions\";\nimport menu_request from \"@/api/menu\";\nimport {update_Menu_Role} from \"@/util/confireMessage\";\nimport {ElMessage} from \"element-plus\";\n\nexport default {\n  name: 'Permission',\n  data() {\n    return {\n      roles: [],\n      accordion: -1,\n      operation: [],\n      total: null,// 操作权限总条数,\n      page: 1,\n      size: 3,\n      menuData: [],\n      checkedNodes: [],\n      defaultProps: {\n        children: 'menus',\n        label: 'menu_name',\n      }\n    }\n  },\n  methods: {\n    // 初始化所有菜单\n    initMenu() {\n      menu_request.getAllMenus().then(resp => {\n        this.menuData = resp.data;\n      })\n    },\n    // 初始化所有角色\n    initRole() {\n      requestUtil.getAllRoles().then(resp => {\n        this.roles = resp.data;\n      })\n    },\n    // 初始化用户所有操作权限\n    initPermissions() {\n      permissions_request.getAllPermByPage(this.page, this.size).then(resp => {\n        this.operation = resp.data;\n      })\n    },\n    // 初始化操作权限条数\n    initCount() {\n      permissions_request.getPermissionCount().then(resp => {\n        this.total = resp.data;\n      })\n    },\n    // collapse切换\n    changeItem(rId) {\n      // 切换item时候，里面的数据需及时刷新\n      this.initMenu();\n      this.checkedNodes=[];\n      if (rId == null || rId == '') return;\n      menu_request.getMenusChecked(rId).then(resp => {\n        this.checkedNodes=resp.data;\n        console.log(this.checkedNodes);\n      });\n    },\n    // 取消修改菜单权限\n    cancel(){\n      this.checkedNodes=[];\n      this.accordion=-1;\n    },\n    // 确认修改\n    sure(role){\n      if(this.checkedNodes.length==0){\n        ElMessage.error(\"请选择菜单权限\");\n        return;\n      }\n      update_Menu_Role(role,this.checkedNodes);\n    },\n    handleSizeChange(size) {\n      this.size = size;\n      this.initPermissions();\n    },\n    handleCurrentChange(page) {\n      this.page = page;\n      this.initPermissions();\n    }\n  },\n  mounted() {\n    this.initRole();\n    this.initPermissions();\n    this.initCount();\n  }\n}\n</script>\n<style scoped>\n.collapse {\n  margin-top: 30px;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}